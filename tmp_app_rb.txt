require 'sinatra'require 'sinatra/reloader' if development?require 'sqlite3'require 'json'set :bind, '0.0.0.0'# --- Database setup ---DB = SQLite3::Database.new('database.db')DB.results_as_hash = trueDB.execute <<~SQL  CREATE TABLE IF NOT EXISTS pieces (    id INTEGER PRIMARY KEY AUTOINCREMENT,    name TEXT,    symbol TEXT,    color TEXT,    x INTEGER,    y INTEGER  );SQLDB.execute <<~SQL  CREATE TABLE IF NOT EXISTS meta (    key TEXT PRIMARY KEY,    value TEXT  );SQL# --- Helper methods ---def get_pieces  DB.execute('SELECT * FROM pieces')enddef reset_board  DB.execute('DELETE FROM pieces')  # simple test setup (can later be replaced)  8.times do |x|    DB.execute('INSERT INTO pieces (name, symbol, color, x, y) VALUES (?, ?, ?, ?, ?)', ['Pawn', '♙', 'white', x, 6])    DB.execute('INSERT INTO pieces (name, symbol, color, x, y) VALUES (?, ?, ?, ?, ?)', ['Pawn', '♟', 'black', x, 1])  end  DB.execute('INSERT INTO pieces (name, symbol, color, x, y) VALUES (?, ?, ?, ?, ?)', ['King', '♔', 'white', 4, 7])  DB.execute('INSERT INTO pieces (name, symbol, color, x, y) VALUES (?, ?, ?, ?, ?)', ['King', '♚', 'black', 4, 0])  DB.execute('DELETE FROM meta')  DB.execute('INSERT INTO meta (key, value) VALUES (?, ?)', ['turn', 'white'])enddef get_turn  result = DB.get_first_value('SELECT value FROM meta WHERE key = ?', 'turn')  result || 'white'enddef switch_turn  new_turn = get_turn == 'white' ? 'black' : 'white'  DB.execute('UPDATE meta SET value = ? WHERE key = ?', [new_turn, 'turn'])end# --- Routes ---get '/' do  @pieces = get_pieces  @turn = get_turn  slim :indexendpost '/move' do  from_x, from_y = params[:from].split(',').map(&:to_i)  to_x, to_y = params[:to].split(',').map(&:to_i)  piece = DB.get_first_row('SELECT * FROM pieces WHERE x = ? AND y = ?', [from_x, from_y])  if piece    DB.execute('DELETE FROM pieces WHERE x = ? AND y = ?', [to_x, to_y]) # capture    DB.execute('UPDATE pieces SET x = ?, y = ? WHERE id = ?', [to_x, to_y, piece['id']])    switch_turn  end  redirect '/'endpost '/reset' do  reset_board  redirect '/'end